<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="../static/view.css" rel="stylesheet" /> 
    <script src="http://code.jquery.com/jquery-1.8.2.min.js"></script> 
    <title>QNA-Teacher</title>
</head>
<body>
    <div class="header" style="text-align: right">
        <input type='button' value='dev_func generate dummy' onclick='addDummyQuestion()' />
    </div>
    <br>
    <div id = "question_board">
        <div id = 'qnaModal'>
            <div id ='qnaModal_contents'>
                <input id = "pin" type="button" value="PIN">
                <span id='modal_close' class='close'> x </span>
                <br>
                <div id = 'qnaModal_qTitle' class='headline4'></div>
                <div id = 'qnaModal_qDateUser' class='inline-date'></div>
                <hr>
                <div id = 'qnaModal_qContents' class='qcontents'></div>
                <hr>
                <span class='headline4'>A.</span>
                <div id = 'qnaModal_anwerContents' class='answer_contents'></div>
                <textarea id="input_answer" cols=140 wrap='hard' style="display:none"></textarea>
                <input id = "answer_btn" type="button" value='Answer!' >
            </div>
        </div>
        <div id = "fixed_questions">
        </div>
        <div id = "questions">
        </div>
    </div>

    <script>
        var modal_close = document.getElementById('modal_close');
        modal_close.addEventListener("click", function() {
            modal.style.display = 'none'; 
            document.getElementById('qnaModal_qTitle').innerHTML=''
            document.getElementById('qnaModal_qDateUser').innerHTML=''
            document.getElementById('qnaModal_qContents').innerHTML=''
            document.getElementById('qnaModal_anwerContents').innerHTML=''
            document.getElementById('input_answer').innerHTML=''
        });

        function postAnswer(qbox_obj){
            btn = document.getElementById('answer_btn')
            modal_answer = document.getElementById('qnaModal_anwerContents')
            text_area = document.getElementById('input_answer')

            if (btn.value == 'Answer!'){
                modal_answer.style.display='none'
                text_area.style.display='block'
                
                if (modal_answer.innerHTML != '작성된 답변이 없습니다.'){
                    text_area.value = modal_answer.innerHTML
                }
                btn.setAttribute('value','DONE!')
            }
            else {

                if (text_area.value != ''){
                    modal_answer.innerHTML=text_area.value
                    qbox_obj.getElementsByClassName('answer_contents hide')[0].innerHTML = modal_answer.innerHTML
                }
                else {
                    modal_answer.innerHTML = '작성된 답변이 없습니다.'
                    qbox_obj.getElementsByClassName('answer_contents hide')[0].innerHTML = ''
                }
                modal_answer.style.display='block'
                text_area.style.display='none'
                btn.setAttribute('value','Answer!')
            }
        }
        
        function showFullQnA (qbox_obj) {
            modal = document.getElementById('qnaModal')
            modal_contents = document.getElementById('qnaModal_contents');

            modal_qTitle = document.getElementById('qnaModal_qTitle')
            modal_qDateUser = document.getElementById('qnaModal_qDateUser')
            modal_qContents = document.getElementById('qnaModal_qContents')
            modal_answer = document.getElementById('qnaModal_anwerContents')

            title = qbox_obj.getElementsByClassName('qtitle')[0].innerHTML;
            date = qbox_obj.getElementsByClassName('inline-date')[0].innerHTML;
            user = qbox_obj.getElementsByClassName('user_id')[0].innerHTML;
            contents = qbox_obj.getElementsByClassName('qcontents')[0].innerHTML;
            answer = qbox_obj.getElementsByClassName('answer_contents hide')[0].innerHTML;
            
            modal_qTitle.innerHTML = 'Q. '+title
            modal_qDateUser.innerHTML = date+'by. \''+user+'\''
            modal_qContents.innerHTML = contents
            if(answer ==''){
                modal_answer.innerHTML = '작성된 답변이 없습니다.'
            }
            else{
                modal_answer.innerHTML = answer
            }
            

            /* 교사 선택지 */
            answer_btn = document.getElementById('answer_btn')
            answer_btn.onclick = function() {
                postAnswer(qbox_obj)
            }

            modal.style.display = 'block';
        }        

        function addDummyQuestion() {
            // new div 생성
            newDiv = document.createElement('div');
            newDiv.setAttribute('class','question_box');
            
            const newTitle = document.createElement('span');
            newTitle.setAttribute('class','qtitle')
            newTitle.appendChild(document.createTextNode('(dummy for test) question title on here'));
            
            var date = new Date();
            const createdDate = document.createElement('span')
            createdDate.setAttribute('class','inline-date')
            createdDate.innerHTML = date
            
            var userid = 'user'+(Math.floor(Math.random()*50))
            postUser = document.createElement('span')
            postUser.setAttribute('class', 'user_id')
            postUser.innerHTML='  by. '+userid

            const newContents = document.createElement('p');
            newContents.setAttribute('class', 'qcontents')
            newContents.appendChild(document.createTextNode('(dummy fot test) contents of question on here'));
            
            const answerContents = document.createElement('div');
            answerContents.setAttribute('class','answer_contents hide')
            answerContents.innerHTML = 'some answers'

            newDiv.appendChild(newTitle);
            newDiv.appendChild(createdDate);
            newDiv.appendChild(postUser)
            newDiv.appendChild(document.createElement('hr'))
            newDiv.appendChild(newContents);
            newDiv.appendChild(answerContents)
            newDiv.onclick = function() {showFullQnA(this)}

            // new div를 기존 div에 추가
            document.getElementById('questions').prepend(newDiv);
        }
    
        function pinQuestion (qbox_obj) {

        }
    </script>
</body>
</html>